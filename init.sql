create table person (
    id bigint primary key generated by default as identity,
    name varchar(50) not null,
    age int not null,
    address jsonb,
    unique(name)
);

create type dressing as (
    id bigint,
    name varchar(50),
    age int,
    address jsonb,
    costume varchar(50)
);

CREATE OR REPLACE FUNCTION merge_person(arr dressing[]) RETURNS SETOF dressing LANGUAGE plpgsql AS
$$
DECLARE x dressing;
BEGIN
    FOREACH x IN ARRAY arr LOOP
        return query insert into person(name, age, address) values (x.name, x.age, x.address) on conflict (name) do update set age=x.age, address=x.address returning id,name,age,address,x.costume;
    END LOOP;
    RETURN;
END;
$$;
